<div ng-controller="FilesController as datactrl">
  <div ng-if="!datactrl.resourceExists">
    <div ng-include="main.blueprintTemplateDir+'resource_notfound.html'"></div>
  </div>

  <div ng-if="datactrl.resourceExists">
    <div ng-include="main.blueprintTemplateDir+'breadcrumb.html'"></div>

    <div class="page-header text-center">
      <h3 class="center">Dataset: {{datactrl.datasetInfo.name}}</h3>
      <h5 class="text-justify"><i>{{datactrl.datasetInfo.description}}</i></h5>

      <!-- INHERITANCE DISABLED / ENABLED  -->
      <span
        class="label label-success"
        ng-if='datactrl.datasetInfo["acl_inheritance"] == "Disabled"'
      >
        ACL_INHERITANCE: {{datactrl.studyInfo.acl_inheritance}}
      </span>

      <span
        class="label label-danger"
        ng-if='datactrl.datasetInfo["acl_inheritance"] == "Enabled"'
      >
        ACL_INHERITANCE: {{datactrl.studyInfo.acl_inheritance}}
      </span>
      <!-- - -->

      <div
        ng-repeat='acl in datactrl.datasetInfo["acl"]'
        class="label"
        ng-if="acl != 'object'"
      >
        <span
          ng-if="acl[0] == 'a07gen00'"
          class="palette-Red-500 text"
          ng-class="{'palette-Green-500': acl[2] == 'own'}"
        >
          ACL: {{acl[0]}}:{{acl[2]}}
        </span>

        <span
          ng-if="acl[0] != 'a07gen00' && acl[0] != 'g'"
          class="palette-Red-500 text"
          ng-class="{'palette-Green-500': acl[2] == 'read'}"
        >
          ACL: {{acl[0]}}:{{acl[2]}}
        </span>

        <span
          ng-if="acl[0] == 'g'"
          class="palette-Red-500 text"
          ng-class="{'palette-Green-500': acl[3] == 'read' && datactrl.datasetInfo.access_type=='public'}"
        >
          ACL: {{acl[1]}}:{{acl[3]}}
        </span>
      </div>

      <span
        class="label label-success"
        ng-if='datactrl.datasetInfo.access_type=="private"'
      >
        Access: {{datactrl.datasetInfo.access_type}}
      </span>

      <span
        class="label label-success"
        ng-if='datactrl.datasetInfo.access_type=="restricted"'
      >
        Access: {{datactrl.datasetInfo.access_type}}
      </span>

      <span
        class="label label-danger"
        ng-if='datactrl.datasetInfo.access_type=="public"'
      >
        Access: {{datactrl.datasetInfo.access_type}}
      </span>

      <span
        class="label label-success"
        ng-if='datactrl.datasetInfo.access_type=="inherit"'
      >
        Access: {{datactrl.datasetInfo.access_type}}
      </span>
    </div>

    <div class="panel panel-default" ng-if="!datactrl.loadingResources">
      <!-- PANEL HEADING START -->
      <div class="panel-heading">
        <h4 class="panel-title">
          <i class="material-icons">insert_drive_file</i> This dataset contains
          <ng-pluralize
            count="datactrl.filesCount"
            when="{
            '0': 'no resource',
            'one': 'one resource',
            'other': '{} resources'
        }"
          >
          </ng-pluralize>
        </h4>
      </div>
      <!-- PANEL HEADING END -->

      <!-- PANEL BODY + TABLE START -->
      <div class="panel-body">
        <div
          flow-init="datactrl.flowOptionsResources()"
          flow-files-submitted="$flow.upload()"
          ng-controller="NgFlowController"
          flow-file-error="showNgUploadErrors($file, $message, $flow)"
          flow-file-success="$file.msg = $message"
        >
          <br /><br />

          <div class="well">
            <span class="btn btn-small btn-info" flow-btn
              ><i class="icon icon-file"></i>Upload a file</span
            >
            <span class="text-right">
              <a class="btn btn-small btn-success" ng-click="$flow.resume()"
                >Resume all</a
              >
              <a class="btn btn-small btn-warning" ng-click="$flow.pause()"
                >Pause all</a
              >
              <a class="btn btn-small btn-danger" ng-click="$flow.cancel()"
                >Cancel all</a
              >
            </span>
            <span ng-if="$flow.getSize() > 0" class="label label-info"
              >Total Size: {{$flow.getSize() | bytes}}</span
            >
          </div>
          <div class="table-responsive" ng-if="$flow.files.length">
            <table class="table table-hover">
              <tr>
                <th>#</th>
                <th>name</th>
                <th>size</th>
                <!-- <th>relativePath</th> -->
                <!-- <th>uniqueIdentifier</th> -->
                <!-- <th>chunks.length</th> -->
                <th>progress</th>
              </tr>
              <tr ng-repeat="file in $flow.files">
                <td>{{$index+1}}</td>
                <td>{{file.name}}</td>
                <td>{{file.size | bytes}}</td>
                <!-- <td>{{file.relativePath}}</td> -->
                <!-- <td>{{file.uniqueIdentifier}}</td> -->
                <!-- <td>{{file.chunks.length}}</td> -->
                <td
                  ng-include="main.templateDir + 'ngflow.progressbar.html'"
                ></td>
              </tr>
            </table>
          </div>
        </div>

        <div class="table-responsive">
          <table
            ng-show="datactrl.files"
            class="table table-hover table-condensed table-borderless"
            ts-wrapper
          >
            <thead>
              <tr>
                <th ts-criteria="accession" ts-default="descending">
                  Accession
                </th>
                <th ts-criteria="name">File</th>
                <th ts-criteria="content_length | parseInt">Size</th>
                <th ts-criteria="type">Type</th>
                <th ts-criteria="last_modified">Last modification</th>
                <th>Metadata</th>
                <th colspan="2">Status</th>
              </tr>
            </thead>

            <tbody>
              <tr ng-repeat="data in datactrl.files" ts-repeat>
                <td class="accession">{{data.accession}}</td>

                <td style="width: 1%" ng-if="data.status == 'import'">
                  <i class="material-icons">error</i>
                </td>
                <!-- 
            <td ng-if="data.object_type == 'collection'">
                <i class='material-icons'>folder</i> {{data.name}}
            </td>
            <td ng-if="data.object_type == 'dataobject'">
                <i class='material-icons'>insert_drive_file</i> {{data.name}}
            </td>
            <td ng-if="!data.object_type">
                {{data.name}}
            </td>
         -->
                <td><b>{{data.name}}</b></td>
                <td ng-if="data.object_type == 'collection'">
                  {{data.size | bytes}}
                </td>
                <td ng-if="data.object_type == 'dataobject'">
                  {{data.content_length | bytes}}
                </td>
                <td ng-if="!data.object_type">-</td>

                <td>{{data.type}}</td>

                <td>
                  <span uib-tooltip="{{data.last_modified}}">
                    {{data.last_modified | moment: 'fromNow' }}
                  </span>
                </td>

                <td ng-if="data.metadata">
                  <table>
                    <tr ng-repeat="(key, value) in data.metadata">
                      <th style="padding: 0px"><small>{{key}}</small></th>
                      <td style="padding: 0px"><small>{{value}}</small></td>
                    </tr>
                  </table>
                </td>

                <td ng-if="!data.metadata">-</td>

                <td ng-switch on="data.status">
                  <span ng-switch-when="FAILURE">
                    <i class="material-icons palette-Red-500 text">error</i>
                    Import failed
                  </span>
                  <span ng-switch-when="SUCCESS"> Completed </span>
                  <span ng-switch-when="completed"> Completed </span>
                  <span ng-switch-default>
                    <div class="preloader-wrapper small active">
                      <div class="spinner-layer spinner-yellow-only">
                        <div class="circle-clipper left">
                          <div class="circle"></div>
                        </div>
                        <div class="gap-patch">
                          <div class="circle"></div>
                        </div>
                        <div class="circle-clipper right">
                          <div class="circle"></div>
                        </div>
                      </div>
                    </div>
                    <i>{{data.status | lowercase}}...</i>
                  </span>
                </td>

                <td ng-if="profile.isAdmin">
                  <i
                    ng-click="datactrl.reimport(data.accession);"
                    class="material-icons"
                    >refresh</i
                  >
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- PANEL BODY +  TABLE END -->

      <!-- PANEL FOOTER START -->
      <div class="panel-footer">
        <div class="text-right"></div>
      </div>
      <!-- PANEL FOOTER END -->
    </div>
  </div>
  <!-- PANEL END -->
</div>
